{"pageProps":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      h1: \"h1\",\n      p: \"p\",\n      a: \"a\",\n      h2: \"h2\",\n      code: \"code\",\n      pre: \"pre\",\n      ul: \"ul\",\n      li: \"li\",\n      h3: \"h3\"\n    }, _provideComponents(), props.components), {Alert} = _components;\n    if (!Alert) _missingMdxReference(\"Alert\", true);\n    return _jsxs(_Fragment, {\n      children: [_jsx(_components.h1, {\n        children: \"Accessing the NCCID data\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The data is stored in \", _jsx(_components.a, {\n          href: \"https://aws.amazon.com/s3/\",\n          children: \"Amazon Web Services\\nS3\"\n        }), \". Once your organisation has been granted\\naccess, NHSX will send AWS credentials by encrypted email. The\\ncredentials will allow accessing the data.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"We recommend accessing the data using the \", _jsx(_components.a, {\n          href: \"https://aws.amazon.com/cli/\",\n          children: \"Amazon Web Services Command\\nLine Interface (AWS CLI)\"\n        }), \", or client\\nlibraries that interact with S3 such as\\n\", _jsx(_components.a, {\n          href: \"https://boto3.amazonaws.com/v1/documentation/api/latest/index.html\",\n          children: \"Boto3\"\n        }), \".\\nSome examples are provided below.\"]\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Warehouse structure\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The warehouse data is stored in the \", _jsx(_components.code, {\n          children: \"nccid-data-warehouse-prod\"\n        }), \" S3\\nbucket, and access is granted to different\\n\", _jsx(_components.a, {\n          href: \"https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingMetadata.html#object-keys\",\n          children: \"prefixes\"\n        }), \".\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The warehouse training data is organised into prefixes within the\\n\", _jsx(_components.code, {\n          children: \"training\"\n        }), \" prefix, based on image types (or \\\"modality\\\"), patient ID,\\nand date as follows:\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"# CT images & metadata\\ntraining/ct/PATIENT_ID/STUDY_UID/SERIES_UID/IMAGE_UUID.dcm\\ntraining/ct-metadata/PATIENT_ID/STUDY_UID/SERIES_UID/IMAGE_UUID.json\\n\\n# MRI images & metadata\\ntraining/mri/PATIENT_ID/STUDY_UID/SERIES_UID/IMAGE_UUID.dcm\\ntraining/mri-metadata/PATIENT_ID/STUDY_UID/SERIES_UID/IMAGE_UUID.json\\n\\n# X-ray images & metadata\\ntraining/xray/PATIENT_ID/STUDY_UID/SERIES_UID/IMAGE_UUID.dcm\\ntraining/xray-metadata/PATIENT_ID/STUDY_UID/SERIES_UID/IMAGE_UUID.json\\n\\n# Patient clinical data\\ntraining/data/PATIENT_ID/status_DATE.json\\ntraining/data/PATIENT_ID/data_DATE.json\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [\"The \", _jsx(_components.code, {\n            children: \"ct\"\n          }), \", \", _jsx(_components.code, {\n            children: \"mri\"\n          }), \", \", _jsx(_components.code, {\n            children: \"xray\"\n          }), \" folders hold the\\n\", _jsx(_components.a, {\n            href: \"https://www.dicomstandard.org/\",\n            children: \"DICOM\"\n          }), \" images of the given kind.\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"The de-identified \", _jsx(_components.code, {\n            children: \"Patient_ID\"\n          }), \" value is equivalent to the\\n\", _jsx(_components.code, {\n            children: \"(0010,0020)\"\n          }), \" DICOM\\n\", _jsx(_components.a, {\n            href: \"https://www.dicomlibrary.com/dicom/dicom-tags/\",\n            children: \"tag\"\n          }), \" from the\\nimages and \", _jsx(_components.code, {\n            children: \"Pseudonym\"\n          }), \" field from the \", _jsx(_components.code, {\n            children: \"status_DATE.json\"\n          }), \" and\\n\", _jsx(_components.code, {\n            children: \"data_DATE.json\"\n          }), \" clinical data files.\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [_jsx(_components.code, {\n            children: \"STUDY_UID\"\n          }), \" and \", _jsx(_components.code, {\n            children: \"SERIES_UID\"\n          }), \" are equivalent to the \", _jsx(_components.code, {\n            children: \"(0020,000D)\"\n          }), \" and\\n\", _jsx(_components.code, {\n            children: \"(0020,000E)\"\n          }), \" DICOM tags in the given images.\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"The \", _jsx(_components.code, {\n            children: \"...-metadata\"\n          }), \" folders hold the DICOM tags exported as JSON from\\nthe corresponding image file \", _jsx(_components.code, {\n            children: \"IMAGE_UUID.dcm\"\n          }), \" into \", _jsx(_components.code, {\n            children: \"IMAGE_UUID.json\"\n          }), \"\\nto enable quick parsing without the need to download the given image\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"The \", _jsx(_components.code, {\n            children: \"data\"\n          }), \" folder holds the patient medical data, \", _jsx(_components.code, {\n            children: \"status_DATE.json\"\n          }), \"\\nfiles for negative results, and \", _jsx(_components.code, {\n            children: \"data_DATE.json\"\n          }), \" file/files for\\npositive results. \", _jsx(_components.code, {\n            children: \"DATE\"\n          }), \" is formatted as \", _jsx(_components.code, {\n            children: \"YYYY-MM-DD\"\n          }), \", for example\\n\", _jsx(_components.code, {\n            children: \"2020-04-21\"\n          }), \".\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(Alert, {\n        title: \"Data Delay\",\n        children: \"Over time there will be more data added to the warehouse, and they will show up as new patient folders, and new image folders with new images. We expect new data will be made available approximately twice a week.\"\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Using the AWS Command Line Interface\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"The simplest way to retrieve the imaging data is using the AWS CLI:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-shell\",\n          children: \"$ aws s3 sync s3://nccid-data-warehouse-prod/training/ct ct\\ndownload: s3://nccid-data-warehouse-prod/training/ct/Covid1/1.2.3/A.B.C/x.y.z.dcm to ct/Covid1/1.2.3/A.B.C/x.y.z.dcm\\n...\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Repeating this for all the relevant directories you would download the\\nlatest data and images that you don't have locally:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-shell\",\n          children: \"# Remove items from this array that you don't want to download\\nmodalities=(\\\"data\\\" \\\"ct\\\" \\\"ct-metadata\\\" \\\"mri\\\" \\\"mri-metadata\\\" \\\"xray\\\" \\\"xray-metadata\\\")\\nfor modality in ${modalities[@]}; do\\naws s3 sync \\\"s3://nccid-data-warehouse-prod/training/${modality}\\\" \\\"${modality}\\\"\\ndone\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"In the above example \", _jsx(_components.a, {\n          href: \"https://www.gnu.org/software/bash/manual/html_node/Arrays.html\",\n          children: \"Bash\\narrays\"\n        }), \"\\nwere used (the \", _jsx(_components.code, {\n          children: \"modalities\"\n        }), \" variable).\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"For more information check the \", _jsx(_components.a, {\n          href: \"https://docs.aws.amazon.com/cli/index.html\",\n          children: \"AWS CLI\\ndocumentation\"\n        }), \". If you\\nencounter any problems, open an issue on our \", _jsx(_components.a, {\n          href: \"https://github.com/nhsx/covid-chest-imaging-database/issues\",\n          children: \"GitHub\\nrepository\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Using Python and Boto3\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"If you are scripting access to files, we recommend using Python and\\n\", _jsx(_components.a, {\n          href: \"https://boto3.amazonaws.com/v1/documentation/api/latest/index.html\",\n          children: \"Boto3\"\n        }), \".\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"For more information check the \", _jsx(_components.a, {\n          href: \"https://boto3.amazonaws.com/v1/documentation/api/latest/index.html\",\n          children: \"Boto3\\ndocumentation\"\n        }), \".\\nIf you encounter any problems, open an issue on our \", _jsx(_components.a, {\n          href: \"https://github.com/nhsx/covid-chest-imaging-database/issues\",\n          children: \"GitHub\\nrepository\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Below you may find examples of accessing the data in various ways with\\nPython and Boto3.\"\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"Listing files\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-python\",\n          children: \"import boto3\\n\\ns3 = boto3.resource(\\\"s3\\\")\\nbucket = s3.Bucket(name=\\\"nccid-data-warehouse-prod\\\")\\n\\n# List the objects at a given prefix\\nfor obj in bucket.objects.filter(Prefix=\\\"training/data\\\"):\\n   print(f\\\"{obj.key}\\\\t{obj.size}\\\\t{obj.last_modified}\\\")\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"This will result in a list such as:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-python\",\n          children: \"training/data/Covid1/data_2020-05-14.json       1416    2020-05-22 13:38:30+00:00\\ntraining/data/Covid6/data_2020-05-15.json       1560    2020-05-22 13:38:31+00:00\\n....\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"Downloading image files\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"To download files using Boto3, if you don't have them locally already:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-python\",\n          children: \"import os\\nimport boto3\\n\\nBUCKET_NAME = \\\"nccid-data-warehouse-prod\\\"\\n\\ndef downloadPrefixFromS3(bucketName, prefix):\\n   \\\"\\\"\\\"This function takes a remote S3 bucket and a prefix,\\n   and downloads all the objects from there, that are not\\n   already stored locally.\\n   \\\"\\\"\\\"\\n   s3 = boto3.resource(\\\"s3\\\")\\n   bucket = s3.Bucket(name=bucketName)\\n   for obj in bucket.objects.filter(Prefix=prefix):\\n      key = obj.key\\n      if os.path.exists(key) and os.stat(key).st_size == obj.size:\\n            # If the file exists and it's the right size, we should be done\\n            print(f\\\"{key}: already have locally\\\")\\n            continue\\n      if not os.path.exists(os.path.dirname(key)):\\n            os.makedirs(os.path.dirname(key))\\n      print(f\\\"{key}: downloading\\\")\\n      bucket.download_file(key, key)\\n\\n# Download a specific prefix. Don't forget the final \\\"/\\\" to limit to the exact prefix\\ndownloadPrefixFromS3(BUCKET_NAME, \\\"training/mri/\\\")\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The above code will create the folders corresponding to the remote\\nprefixes in the current working directory as needed, and only download\\nfiles that are not yet downloaded (similar to \", _jsx(_components.code, {\n          children: \"aws s3 sync\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"Opening image files\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"You can also access a remote DICOM image, download into memory and open\\nit with, for example with the \", _jsx(_components.a, {\n          href: \"https://github.com/pydicom/pydicom\",\n          children: \"PyDICOM\\nlibrary\"\n        }), \":\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-python\",\n          children: \"from io import BytesIO\\n\\nimport boto3\\nimport pydicom\\n\\ns3 = boto3.resource(\\\"s3\\\")\\nbucket = s3.Bucket(name=\\\"nccid-data-warehouse-staging\\\")\\n\\nimage_name = \\\"training/xray/Covid1/1.2.3/A.B.C/x.y.z.dcm\\\"\\n\\nwith BytesIO() as tmp:\\n   print(f\\\"Downloading: {image_name}\\\")\\n   bucket.Object(key=image_name).download_fileobj(tmp)\\n   tmp.seek(0)\\n   # Do not read the image only the metadata here.\\n   # To also read the image, remove set stop_before_pixels to False\\n   image_data = pydicom.dcmread(tmp, stop_before_pixels=True)\\n   print(image_data)\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"This code would result in an output such as:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"Downloading: training/xray/Covid1/1.2.3/A.B.C/x.y.z.dcm\\n(0008, 0005) Specific Character Set              CS: 'ISO_IR 100'\\n(0008, 0008) Image Type                          CS: ['ORIGINAL', 'PRIMARY', '', 'RT', '', '', '', '', '150000']\\n(0008, 0016) SOP Class UID                       UI: Digital X-Ray Image Storage - For Presentation\\n...\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"Loading a JSON file\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Similarly to the image download above, JSON files can also be directly\\naccessed, using the \", _jsx(_components.a, {\n          href: \"https://docs.python.org/3/library/json.html\",\n          children: \"built in Python json\\nlibrary\"\n        }), \" such as:\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-python\",\n          children: \"import json\\nfrom io import BytesIO\\n\\nimport boto3\\n\\ns3 = boto3.resource(\\\"s3\\\")\\nbucket = s3.Bucket(name=\\\"nccid-data-warehouse-prod\\\")\\n\\njson_name = \\\"training/data/Covid1/data_2020-05-14.json\\n\\nwith BytesIO() as tmp:\\n   print(f\\\"Downloading: {json_name}\\\")\\n   bucket.Object(key=json_name).download_fileobj(tmp)\\n   tmp.seek(0)\\n   json_data = json.load(tmp)\\n   print(json.dumps(json_data, indent=4, sort_keys=True))\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"The output of the above code would be similar to this:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"Downloading: training/data/Covid1/data_2020-05-14.json\\n{\\n   \\\"Pseudonym\\\": \\\"Covid1\\\",\\n   ...\\n}\\n\"\n        })\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{"title":"Accessing the NCCID data","summary":"The data is stored in Amazon Web Services S3.  Once your organisation has been granted access, NHSX will send AWS credentials by encrypted email.  The credentials will allow accessing the data.","category":"Technical Documentation"}},"meta":{"title":"Accessing the NCCID data","summary":"The data is stored in Amazon Web Services S3.  Once your organisation has been granted access, NHSX will send AWS credentials by encrypted email.  The credentials will allow accessing the data.","category":"Technical Documentation"}},"__N_SSG":true}